<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout" layout:decorator="layout/page-layout">
<th:block layout:fragment="content-breadcrumb-fragment">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">지도 관리</li>
            <li class="breadcrumb-item active" aria-current="page">Map 관리</li>
        </ol>
    </nav>
</th:block>
<th:block layout:fragment="content-title-fragment">
    <h1 class="h2 mb-0 text-gray-800">Map 관리</h1>
    <div id="map_config_button">
        <a th:href="@{/view/manage/map-form}" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm">
            <i class="fas fa-plus fa-sm text-white-50"></i> Map 추가
        </a>
        <a th:href="@{/view/manage/layer-manage}" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm">
            <i class="fas fa-list fa-sm text-white-50"></i> Layer 관리
        </a>
    </div>
</th:block>
<th:block layout:fragment="content-body-fragment">
    <div id="layer_list_view">
        <table id="list_table" class="table table-sm table-striped">
            <thead class="table-info">
            <tr>
                <th scope="col" class="text-center">이름</th>
                <th scope="col" class="text-center">설명</th>
                <th scope="col" class="text-center">투영</th>
                <th scope="col" class="text-center">OUTPUT FORMAT</th>
                <th scope="col" class="text-center">생성일</th>
                <th scope="col" class="text-center">기본여부</th>
                <th scope="col" class="text-center">삭제</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="map : ${ maps }">
                <td class="text-center" th:text="${ map.name }"></td>
                <td class="text-center" th:text="${ map.description }"></td>
                <td class="text-center" th:text="${ map.projection }"></td>
                <td class="text-center" th:text="${ map.imageType }"></td>
                <td class="text-center" th:text="${ map.registTime }"></td>
                <td class="text-center" th:text="${ map.isDefault() }"></td>
                <td class="text-center">
                    <span th:if="${!map.isDefault()}" class="btn btn-danger btn-sm" th:onclick="delMap(this,[[${map.name}]],[[${map.id}]])" >
                        <i class="fas fa-trash"></i>
                    </span>
                </td>
            </tr>
            </tbody>
        </table>
        <script th:inline="javascript">
            var message = /*[[ ${message} ]]*/ null;
            var table = null;

            $(document).ready(function() {
                if (!jQuery.isEmptyObject(message)) {
                    toastr.info(message);
                }
                table = $('#list_table').DataTable();
                $('#source-name').change(function() {
                    $('#source-name').data("check-duplicate",false);
                    $('#duplicate-check-message').text("중복확인을 해주세요.");
                })
            });

            function delMap(ths, mapName, mapId) {
                if (confirm("[ " + mapName + " ] Map 을 제거 하시겠습니까?")) {
                    jQuery.post({
                        url: CONTEXT + "/view/manage/del-map",
                        data: {mapId : mapId}
                    }).done(function(result) {
                        if(result) {
                            toastr.success("Map [ " + mapName+ " ] 가 제거 되었습니다.");
                            table.row(jQuery(ths).parents('tr')).remove();
                            table.draw();
                        } else {
                            toastr.error('Map 제거 중 오류가 발생하였습니다.');
                        }
                    }).fail(function() {
                        toastr.error('Map 제거에 실패하였습니다.');
                    }).always(function() {
                        jQuery("#loader-wrapper").hide();
                    })
                }
            }
        </script>
    </div>
</th:block>
</html>